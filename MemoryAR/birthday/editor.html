<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html,
        body {
            margin: 0;
            width: 100%;
            height: 100%;
        }

        .form-container {
            width: 100%;
            height: 20%;
            /* Set the height of the form container to 20% of the page height */
        }

        .iframe-container {
            position: relative;
            width: 100vw;
            height: 80vh;
            /* Set the height of the iframe container to 80% of the page height */
        }

        .form-input {
            margin: 5px;
            width: 60%;
        }

        .form-title {
            margin: 10px;
            width: 30%;
        }

        .iframe-child {
            width: 100%;
            height: 100%;
            /* Set the height of the iframe container to 80% of the page height */
        }
    </style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VPNZHH80ZC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-VPNZHH80ZC');
    </script>

    <script>
        /**
        * The following event is sent when the page loads. You could
        * wrap the event in a JavaScript function so the event is
        * sent when the user performs some action.
        */
        gtag('event', 'screen_view', {
            'app_name': 'memory_ar',
            'screen_name': 'birthday_page_editor'
        });

        let queryString = window.location.search;
        let urlParams = new URLSearchParams(queryString);

        if (urlParams.has("campaign")) {
            let campaign = urlParams.get('campaign');
            gtag('campaign', {
                'source': campaign
            });
        }

    </script>

    <script>
        let ageData = 17;
        let nameData = "Memory AR";
        let fromData = "Memory AR";
        function updateIframe() {
            gtag('editor', {
                'action': 'preview'
            });
            // Get the value of the iframe-src input field
            ageData = document.getElementById('iframe-src').value;
            nameData = document.getElementById('iframe-src2').value;
            fromData = document.getElementById('iframe-src3').value;
            // Set the src attribute of the iframe element
            document.querySelector('iframe').src = "index.html?age=" + ageData + "&name=" + nameData + "&from=" + fromData;
        }
        function share() {
            updateIframe();
            // var src = document.getElementById('iframe-src').value;
            // var src2 = document.getElementById('iframe-src2').value;
            // var src3 = document.getElementById('iframe-src3').value;

            // navigator.clipboard.writeText("index.html?age=" + ageData + "&name=" + nameData + "&from=" + fromData);
            // navigator.permissions.query({ name: "write-on-clipboard" }).then((result) => {
            //     if (result.state == "granted" || result.state == "prompt") {
            //         alert("index.html?age=" + ageData + "&name=" + nameData + "&from=" + fromData);
            //     }
            // });
            let queryString = window.location.search;
            let urlParams = new URLSearchParams(queryString);
            let campaign = "share";
            if (urlParams.has("campaign")) {
                campaign = urlParams.get('campaign');
            }

            let sourceIndex = window.location.href;

            let html;
            let dataShare;
            if (sourceIndex.includes("?")) {
                dataShare = window.location.href.replace("/editor.html", "/index.html") + "&age=" + ageData + "&name=" + nameData + "&from=" + fromData;
            } else {
                dataShare = window.location.href.replace("/editor.html", "/index.html") + "?age=" + ageData + "&name=" + nameData + "&from=" + fromData;
            }
            navigator.clipboard.writeText(dataShare).then(() => {
                alert('Content copied to clipboard');
                /* Resolved - text copied to clipboard successfully */
            }, () => {
                alert('Failed to copy');
                /* Rejected - text failed to copy to the clipboard */
            });

            gtag('editor', {
                'action': 'share'
            });

        }
    </script>
</head>

<body>
    <div class="form-container">
        <!-- Form to edit the iframe goes here -->
        <form onsubmit="updateIframe(); return false;">
            <label class="form-title" for="iframe-src">Age :</label>
            <input class="form-input" type="text" id="iframe-src" name="iframe-src" value="17"><br>

            <label class="form-title" for="iframe-src">Name :</label>
            <input class="form-input" type="text" id="iframe-src2" name="iframe-src" value="celine"><br>

            <label class="form-title" for="iframe-src">From :</label>
            <input class="form-input" type="text" id="iframe-src3" name="iframe-src" value="zach"><br>
            <input type="submit" value="Preview">
            <button type="button" onclick="share()">Preview & Share</button>
        </form>
    </div>

    <div class="iframe-container">
        <iframe class="iframe-child" src="index.html"></iframe>
    </div>
</body>

</html>